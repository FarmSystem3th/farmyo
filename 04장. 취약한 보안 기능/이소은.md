# 4장 - 취약한 보안 기능
취약한 보안 기능이란 다음의 것들을 하지 않음으로써 발생하는 취약점이다. 
1) 사용자 식별이나 권한 확인
2) 세션 관리
3) 암호화모듈을 이용한 중요 데이터 입력 값 암호화
4) SSL을 이용한 암호화 통신

## 취약한 보안 기능을을 이용한 공격의 예
1) 불충분한 인증: 사용자의 인증을 우회해 익명성을 갖게 됨 <br>
2) 불충분한 인가: 권한 없는 게시판 / 게시물에 접근하여 글쓰기 / 수정 / 삭제 <br>
3) 데이터 평문 전송: 암호화를 하지 않아 중요 정보가 평문으로 전송됨 <br>

## 해결 방법
❎ : 침입탐지시스템(IDS), 침입방지시스템(IPS) <br>
✅ : 개발 시에 시큐어 코딩, 암호화 모듈을 통한 패킷 암호화, SSL 통신 <br> <br>

➡️ 정상 사용자의 행위와 구분하기 어렵기 때문이다.




---


## 1) 불충분한 인증
- 실명 인증 우회 확인 방법 <br>
### 🔐 대응 방안
- 실명 인증 시 이름, 주민등록번호 등을 🔻세션으로 처리한다. <br>
- 실명 인증에 사용되는 정보는 반드시 암호화하여 전송하거나 🔻HTTPS를 통해 안전하게 전송한다. <br> <br>
🔻 세션: 세션 정보는 서버에 저장한다. 따라서 웹 서버가 종료되거나, 일정 시간동안 서버에 반응을 하지 않으면 자동 삭제된다. <br>
🔻 HTTPS: HTTP 계층 아래의 SSL 서브 계층에서 사용자 페이지 요청을 암호화, 복호화하는 브라우저 설치된 넷스케이프 웹 프로토콜이다. TCP/IP 에서 HTTP 포트 80 대신 포트 443을 사용하고, SSL은 RC4 스트림 암호 알고리즘용으로 40비트 크기의 키를 사용한다.

 
## 2) 불충분한 인가
- 특정 페이지의 접근 권한에 대한 검증 절차의 부재로 인해 접근 권한이 필요한 데이터나 페이지에 비인가된 사용자가 접근할 수 있게되는 취약점
- 불충분한 인가 취약점 확인 방법 <br>
### 🔐 대응 방한
- 히든 필드 값을 그대로 사용하지 말고, 데이터베이스에서 재검색해 값을 새로 얻어온다.
- 또는 히든 필드로 전송된 값들에 대한 검증 절차를 거치게 소스를 수정한다.
- 히든 필드로 값을 넘기는 것보다는 세션을 통해 변수를 저장하고, 관리하는 것이 안전하다.
- 사용자의 URI 조작에 의해 변경이 일어날 수 있는 페이지에 대해서는 인증 절차를 삽입한다.
- 웹 애플리케이션을 개발할 때에는 중요 정보를 항상 세션으로 처리함으로써 세션을 통한 인증 절차를 거치게 한다.

## 3) 불충분한 세션 관리
1) 인증 시마다 동일한 세션 ID가 발급된다.
2) 세션 만료 기간을 정하지 않아 로그아웃 후 세션이 유효한 상태로 유지된다.
3) 세션 만료 일잘르 너무 길게 설정하여 공격자가 만료되지 않은 세션을 활용 가능하다.

### 🔐 대응 방안
- 로그인 시마다 새로운 세션 아이디를 발급받게 한다.
- 이때 생성되는 값은 랜덤해야 한다.
- 세션 타임아웃을 설정하여 일정 시간동안 액션이 없을 경우 자동으로 로그아웃되게 설정해야 한다.

## 4) 데이터 평문 전송
- 서버와 클라이언트간 통신 시 데이터를 암호화하여 전송하지 않음으로써 중요 정보 등이 평문으로 전송되는 취약점이다.
- 개인 정보를 암호화지 않고 평문으로 전송 처리할 경우 도청을 통해 정보가 노출될 수 있다.
- 🔻 스니핑
- 쿠키를 사용할 경우 쿠키의 내용이 암호화 없이 평문으로 전송될 경우 정보 노출로 인한 피해가 발생할 수 있다.

🔻 스니핑: 가장 많이 사용되는 해킹 수법으로, 이더넷(Ethernet) 상에서 전될되는 모든 패킷을 분석해 사용자의 계정과 암호를 알아내는 것이다. 

### 🔐 대응 방안
- 로그인이나 개인 정보를 사용하는 사이트는 SSL 인증서나 암호화 애플리케이션을 설치해 개인 정보를 암호화해서 송수신을 한다.
- 🔻 SSL은 내부 공격자에 대해 취약하기 때문에 이중 보안의 관점에서 SSL 인증서를 적용하거나, 중요 매개변수에 대해서는 RSA나 DES 등으로 암호화를 해야한다.
- SSL 통신은 SSL MITM(중간자) 공격이나 🔻 SSL Strip 공격에 취약하고, SLL 가속기를 지났을 때는 HTTPS의 암호화가 해제되기 때문이다.


🔻 SSL Strip: HTTPS가 아니라 HTTP로 통신하게 만드는 것이다. <br>

#### TLS (Transport Layer Security)
SSL은 좀 더 안전하게 만들고 높은 정확성과 완벽성을 제공하기 위해 만들어졌다. 
1) 좀 더 안전한 HMAC 알고리즘
2) 향상된 PRF (Pseudo Random Function)
3) 일관성 있는 인증 처리
4) 구체적인 경고 메시지


## 5) 쿠키 변조
적절히 보호되지 않은 쿠키를 사용할 경우, 쿠키 인젝션 등과 같은 쿠키 값 변졸르 통한 다른 사용자로의 위장이나 권한 상승이 가능한 취약점이다. 
공격자는 중요 정보로 구성되어 있는 쿠키 정보를 조작해 다른 사용자의 유효한 세션을 취득할 수 있다. 

### 🔐대응 방안
- SSL
- 암호화 모듈을 사용해 쿠키 값을 암호화
- 쿠키는 클라이언트에 전달되는 값이기 때문에, 쿠키를 사용하는 것보다는 서버측 세션을 사용하는 편이 바람직하다.
- 서버 측에 세션 정보를 저장해 상호 세션 값을 이용해 상호 대조할 수 있게 한다.
- 반드시 세션 타임아웃 시간을 설정한다. 
